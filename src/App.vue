<script setup lang="ts">
import { NGrid, NGi, NWatermark } from 'naive-ui'
import Introduction from './components/Introduction.vue'
import ReqLogin from './components/ReqLogin.vue'
import NotWebvpn from './components/NotWebvpn.vue'
import Loading from './components/Loading.vue'
import LoadingFail from './components/LoadingFail.vue'
import BuildInfo from './components/BuildInfo.vue'
import RememberPass from './components/RememberPass.vue'
import { ref } from 'vue'
import axios from 'axios'

const GetInfoMain = 'https://webvpn.bit.edu.cn/https/77726476706e69737468656265737421fcf84695297e6a596a468ca88d1b203b/campus-account/myAccount/info'
const BUILD_MODE = import.meta.env.VITE_BUILD_MODE


const isWebvpn = () => {
  if(BUILD_MODE === 'development') return true;
  return typeof(vpnGlobal) === 'object'
}
const notWebvpn = ref(!isWebvpn())
const StatusChecked = ref(false)
const LoadingFailed = ref(false)
const isLogined = ref(false)

const CheckLogin = () => {
  axios.get(GetInfoMain,{maxRedirects: 0}).then((res)=>{
    let htmlText = res.data
    if(htmlText.indexOf('个人账户信息') != -1){
      isLogined.value = true
    }else{
      isLogined.value = false
    }
    StatusChecked.value = true
  }).catch((err)=>{
    StatusChecked.value = true
    LoadingFailed.value = true
    console.log(err)
  })
}

CheckLogin()

</script>

<template>
  <n-watermark
    content="仅演示，勿恶意利用"
    cross
    fullscreen
    :font-size="16"
    :line-height="10"
    :width="384"
    :height="384"
    :x-offset="1"
    :y-offset="60"
    :rotate="-15"
  />
  <n-grid :cols="10" item-responsive>
    <n-gi span="0 600:1"/>
    <n-gi id="content" span="10 600:8">
      <BuildInfo />
      <Introduction />
      <NotWebvpn v-if="notWebvpn"/>
      <Loading v-show="!StatusChecked" />
      <LoadingFail v-if="!notWebvpn" v-show="LoadingFailed" />
      <ReqLogin v-if="!notWebvpn" v-show="StatusChecked&&!LoadingFailed&&!isLogined"/>
      <RememberPass v-if="!notWebvpn" v-show="StatusChecked&&isLogined"/>
    </n-gi>
    <n-gi span="0 600:1" />

  </n-grid>
</template>

<style scoped>
#content{
  background-color: #eaecedaa;
  padding: 10px;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
}
</style>
