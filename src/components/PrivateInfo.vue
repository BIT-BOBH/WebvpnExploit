<script setup lang="ts">
import { onMounted,ref } from 'vue';
import { NCard,NTag,NInput } from 'naive-ui'
import { NTable, NThead, NTbody } from 'naive-ui'
import $ from 'jquery'
import { NImage } from 'naive-ui'
import defaultImg from '/src/assets/default.jpg'

const fetchBasicVector = ['人员代码', '手机号码', '姓名', '个人邮箱', '人员身份类型']
const fetchBasicVector_eng = ['Code', 'Mobile', 'Name', 'Email', 'Type']

const fetchSecurityVector = ['i北理/钉钉绑定手机号']
const fetchSecurityVector_eng = ['iBIT/Dingtalk mobile phone number']

const BasicInfo = ref([])
let dom = null

let FetchBasicInfo = (tag) => {
  if(!dom) return ""
  const dts = dom.find('dt')
  for(let i=0;i<dts.length;i++){
    if(dts[i].innerText.trim() == tag){
      return dts[i].nextElementSibling.innerText.trim()
    }
  }
  return ""
}

let FetchSecurityInfo = (tag) => {
  if(!dom) return ""
  const divs = dom.find('.span2.center.bigger-150')
  for(let i=0;i<divs.length;i++){
    if(divs[i].innerText.trim() == tag){
      return divs[i].nextElementSibling.innerText.trim()
    }
  }
  return ""
}

const FinishLoad = (html)=>{
  document['sub_dom'] = $(html)
  dom = $(html)
  for(let i=0;i<fetchBasicVector.length;i++){
    let res = FetchBasicInfo(fetchBasicVector[i])
    if(res == "") res = FetchBasicInfo(fetchBasicVector_eng[i])
    BasicInfo.value.push({
      name: fetchBasicVector[i],
      value: res
    })
  }
  for(let i=0;i<fetchSecurityVector.length;i++){
    let res = FetchSecurityInfo(fetchSecurityVector[i])
    if(res == "") res = FetchSecurityInfo(fetchSecurityVector_eng[i])
    BasicInfo.value.push({
      name: fetchSecurityVector[i],
      value: res
    })
  }
  console.log(BasicInfo.value)
}
defineExpose({FinishLoad})

</script>

<template>
  <n-card style="margin-top:10px;" id="个人信息" title="个人信息展示" hoverable embedded content-style="font-size: 1.2em;">
    下面是跨域获得的你的一些个人信息（仅展示，不会被上传）:
    <br/>
    <n-image
      width="150"
      height="200"
      src="https://webvpn.bit.edu.cn/https/77726476706e69737468656265737421fcf84695297e6a596a468ca88d1b203b/campus-account/myAccount/showPhoto?vpn-1"
      style="margin-top: 10px; margin-left: 20px; margin-bottom: 10px;"
      >
      <template #placeholder>
        <n-image width="150" height="200" :src="defaultImg" />
      </template>
    </n-image>
    <n-table :single-line="false">
        <thead>
          <tr>
            <th>内容</th>
            <th>值</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(item, index) in BasicInfo" :key="index">
            <td>{{ item.name }}</td>
            <td>{{ item.value }}</td>
          </tr>
        </tbody>
      </n-table>
    </n-card>
</template>

<style>

</style>